@{
	ViewBag.Title = "Admin Dashboard";
	Layout = "~/Views/Shared/_AdminNav.cshtml";
}
<link href="/css/admin/dashboard.css" rel="stylesheet" type="text/css" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<div class="layout">
	<div class="content">
		<div id="dashboard" class="module-page active">
			<div class="module-header">
				<h2 class="module-title">Dashboard Overview</h2>
			</div>

			<!-- Stats Grid -->
			<div class="stats-grid">
				<div class="stat-card">
					<div class="stat-header">
						<div class="stat-title">Total Students</div>
						<div class="stat-icon" style="background: rgba(102, 126, 234, 0.1); color: #667eea;">👨‍🎓</div>
					</div>
					<div class="stat-value">@ViewBag.TotalStudents</div>
					
				</div>

				<div class="stat-card">
					<div class="stat-header">
						<div class="stat-title">Total Admins</div>
						<div class="stat-icon" style="background: rgba(56, 161, 105, 0.1); color: #38a169;">📝</div>
					</div>
					<div class="stat-value">@ViewBag.TotalAdmins</div>
					
				</div>

				<div class="stat-card">
					<div class="stat-header">
						<div class="stat-title">Pending Reviews</div>
						<div class="stat-icon" style="background: rgba(237, 137, 54, 0.1); color: #ed8936;">⏳</div>
					</div>
					<div class="stat-value">@ViewBag.TotalPending</div>
				
				</div>
			</div>

			<!-- Chart Section -->
			<div class="chart-section">
				<div class="chart-header">
					<h3 class="chart-title">Most Used Services</h3>
					<div class="chart-filters">
						<button class="filter-btn active" onclick="filterChart('overall', event)">Overall</button>
					</div>
				</div>

				<div class="chart-container">
					<canvas id="servicesChart"></canvas>
				</div>

				<!-- Legend -->

				<div class="legend-item">
					<div class="legend-color" style="background: #667eea;"></div>
					<span>Originality Check</span>
					<span class="legend-value">@((ViewBag.ServiceCounts != null && ViewBag.ServiceCounts.ContainsKey("Originality Check")) ? ViewBag.ServiceCounts["Originality Check"] : 0)</span>
				</div>

				<div class="legend-item">
					<div class="legend-color" style="background: #38a169;"></div>
					<span>Instrument Validation</span>
					<span class="legend-value">@((ViewBag.ServiceCounts != null && ViewBag.ServiceCounts.ContainsKey("Instrument Validation")) ? ViewBag.ServiceCounts["Instrument Validation"] : 0)</span>
				</div>

				<div class="legend-item">
					<div class="legend-color" style="background: #ed8936;"></div>
					<span>Language Editing</span>
					<span class="legend-value">@((ViewBag.ServiceCounts != null && ViewBag.ServiceCounts.ContainsKey("Language Editing")) ? ViewBag.ServiceCounts["Language Editing"] : 0)</span>
				</div>

				<div class="legend-item">
					<div class="legend-color" style="background: #e53e3e;"></div>
					<span>Data Analysis</span>
					<span class="legend-value">@((ViewBag.ServiceCounts != null && ViewBag.ServiceCounts.ContainsKey("Data Analysis")) ? ViewBag.ServiceCounts["Data Analysis"] : 0)</span>
				</div>

				<div class="legend-item">
					<div class="legend-color" style="background: #8b5cf6;"></div>
					<span>Student Research Clearance</span>
					<span class="legend-value">@((ViewBag.ServiceCounts != null && ViewBag.ServiceCounts.ContainsKey("Student Research Clearance")) ? ViewBag.ServiceCounts["Student Research Clearance"] : 0)</span>
				</div>

				<div class="legend-item">
					<div class="legend-color" style="background: #f56565;"></div>
					<span>Ethics Review</span>
					<span class="legend-value">@((ViewBag.ServiceCounts != null && ViewBag.ServiceCounts.ContainsKey("Ethics Review")) ? ViewBag.ServiceCounts["Ethics Review"] : 0)</span>
				</div>
			</div>
		</div>
	</div>
</div>

<script>
	let servicesChart;
	const serviceCounts = @Html.Raw(Json.Serialize(ViewBag.ServiceCounts ?? new Dictionary<string, int>()));

	function renderChart() {
		const ctx = document.getElementById('servicesChart').getContext('2d');

		// Destroy old chart instance
		if (servicesChart) {
			servicesChart.destroy();
		}

		// Extract actual labels and counts
		const labels = Object.keys(serviceCounts);
		const dataValues = Object.values(serviceCounts);

		// Define colors (same as your legend)
		const colors = ["#667eea", "#38a169", "#ed8936", "#e53e3e", "#8b5cf6", "#f56565"];

		// Chart configuration (keep your original line style)
		servicesChart = new Chart(ctx, {
			type: 'line',
			data: {
				labels: labels,
				datasets: [{
					label: 'Total Availed Services',
					data: dataValues,
					borderColor: colors,
					backgroundColor: "transparent",
					borderWidth: 3,
					fill: false,
					tension: 0.3,
					pointRadius: 6,
					pointHoverRadius: 8
				}]
			},
			options: {
				responsive: true,
				maintainAspectRatio: false,
				plugins: {
					legend: { display: false },
					title: {
						display: true,
						text: 'Total Availed Services per Type',
						font: { size: 16 }
					}
				},
				scales: {
					y: {
						beginAtZero: true,
						title: { display: true, text: "Number of Services" }
					},
					x: {
						title: { display: true, text: "Service Type" }
					}
				}
			}
		});
	}

	function filterChart(period, event) {
		renderChart();

		document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
		event.target.classList.add('active');
	}

	document.addEventListener("DOMContentLoaded", () => {
		renderChart();
	});
</script>
