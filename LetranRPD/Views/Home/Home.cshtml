@{
ViewBag.Title = "Home";
Layout = "~/Views/Shared/_Layout.cshtml";
var currentUser = Context.Session.GetObject<Account>("account") ?? null;
}

<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="/css/Home.css" />

<div class="banner">
    <div class="banner-image">
        <img src="@Url.Content("~/BG/Letran Night.jpg")" alt="Banner">
    </div>
    <div class="banner-content">
        <h5>
            @if (currentUser != null)
            {
                <div>Welcome @currentUser.FirstName, to</div>
            }
            else
            {
                <div>Login to use the services.</div>
            }
        </h5>
        <h1>LETRAN RESEARCH &<br>PUBLICATION DEPARTMENT</h1>
        <p>Let's Get You Started!</p>
        <a href="/Home/Services" class="btn">VIEW SERVICES</a>
    </div>
</div>

<div class="News-section">
    <div class="breaking-news">
        <h5>RESEARCH & PUBLICATION DEPARTMENT</h5>
        <h1>NEWS</h1>
        <div class="divider"></div>
    </div>

    <div class="news-grid" id="newsGrid">
        <!-- News dynamically loaded from news.json -->
    </div>
</div>


<!-- 📰 Modal -->
<div class="modal fade" id="newsModal" tabindex="-1" aria-labelledby="newsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="newsModalLabel"></h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body text-center">
                <img id="newsModalImage" class="img-fluid mb-3 rounded shadow-sm" />
                <p id="newsModalBody" class="text-start"></p>
            </div>
        </div>
    </div>
</div>



<div class="research-section">
    <div class="research-container">
        <div class="research-content">
            <h1>PUBLISH WITH US!</h1>
            <div class="divider"></div>
            <p>
                There is no doubt that research is one of the pillars of education, alongside instruction and community services. Through research, we can gather new knowledge and information for the enhancement of intellectual understanding and guide in decision-making abilities.
            </p>
            <p>
                Letran Research Center is responsible in providing quality researches and publications to intensify the research culture of the Colegio. Along with its mission to become the torch of light and knowledge, the center aims to:
            </p>
            <ul class="benefits">
                <li>Push the frontiers of knowledge across the identified higher education disciplines in the country</li>
                <li>Enhance the research capability of the members of the institution</li>
                <li>Provide accurate and updated information to academic departments regarding responsive and relevant program of studies</li>
                <li>Promote professional growth through research</li>
            </ul>
        </div>
        <div class="research-image">
            <img src="@Url.Content("~/Gallery/Research Center.png")" alt="RPD News">
        </div>
    </div>
</div>

<script>

           document.addEventListener("DOMContentLoaded", () => {
        loadNews();
    });

    function loadNews() {
        fetch("/js/news.json")
            .then(res => res.json())
            .then(data => {
                const newsGrid = document.getElementById("newsGrid");
                newsGrid.innerHTML = "";

                if (!data || data.length === 0) {
                    newsGrid.innerHTML = `<p style="text-align:center; color:#888;">No news available yet.</p>`;
                    return;
                }

                // 📰 First news is large main article
                const mainNews = data[0];
                const largeItem = `
                    <div class="news-item large image-overlay">
                        <img src="${mainNews.ImagePath || '/News/default.png'}" alt="${mainNews.Title}">
                        <div class="overlay-content">
                            <h2>${mainNews.Title}</h2>
                            <p>${truncateText(mainNews.Content, 200)}</p>
                            <span class="category">${mainNews.Category || 'General'}</span><br>
                            <button class="btn btn-primary mt-2"
                                    onclick="openNewsModal('${escapeQuotes(mainNews.Title)}',
                                                           '${mainNews.ImagePath || '/News/default.png'}',
                                                           \`${mainNews.Content}\`)">
                                Read More
                            </button>
                        </div>
                    </div>
                `;

                // 🗞️ Remaining news displayed in right column
                const rightColumnItems = data.slice(1).map(n => `
                    <div class="news-item small image-overlay">
                        <img src="${n.ImagePath || '/News/default.png'}" alt="${n.Title}">
                        <div class="overlay-content">
                            <h3>${n.Title}</h3>
                            <span class="category">${n.Category || 'General'}</span><br>
                            <button class="btn btn-primary btn-sm mt-1"
                                    onclick="openNewsModal('${escapeQuotes(n.Title)}',
                                                           '${n.ImagePath || '/News/default.png'}',
                                                           \`${n.Content}\`)">
                                Read More
                            </button>
                        </div>
                    </div>
                `).join("");

                const newsLayout = `
                    ${largeItem}
                    <div class="news-column-right">
                        ${rightColumnItems}
                    </div>
                `;

                newsGrid.innerHTML = newsLayout;
            })
            .catch(err => {
                console.error("Error loading news:", err);
                document.getElementById("newsGrid").innerHTML = `<p style="text-align:center; color:#888;">Failed to load news.</p>`;
            });
    }

    function truncateText(text, length) {
        return text.length > length ? text.substring(0, length) + "..." : text;
    }

    function escapeQuotes(text) {
        return text.replace(/'/g, "\\'").replace(/"/g, '\\"');
    }

    function openNewsModal(title, imageUrl, body) {
        document.getElementById("newsModalLabel").textContent = title;
        document.getElementById("newsModalImage").src = imageUrl;
        document.getElementById("newsModalBody").innerHTML = body;
        var modal = new bootstrap.Modal(document.getElementById('newsModal'));
        modal.show();
    }
</script>
