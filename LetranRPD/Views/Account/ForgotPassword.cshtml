@{
    Layout = "~/Views/Shared/_AuthLayout.cshtml";
    // We get the state from the ViewBag, defaulting to 'false'
    bool isCodeSent = ViewBag.IsCodeSent ?? false;
}
<link rel="stylesheet" href="~/css/login.css">

<div class="login-container">
    <div class="logo-container">
        <img src="~/Gallery/Research logo.png" alt="Research & Publication Department Logo">
    </div>
    <h1>Reset Your Password</h1>

    <div asp-validation-summary="ModelOnly" class="text-danger"></div>

    <form method="post">
        @Html.AntiForgeryToken()

        <label for="email">Student Email</label>
        <input type="email" id="email" name="email" placeholder="Enter your Student Email"
               value="@ViewBag.Email" @(isCodeSent ? "readonly" : "") />

        @if (!isCodeSent)
        {
            <button type="submit" class="btn" asp-action="SendResetCode">Send Reset Code</button>
        }


        @if (isCodeSent)
        {
            <input type="hidden" name="email" value="@ViewBag.Email" />

            <hr style="margin: 20px 0;" />

            <label for="otp">6-Digit Code</label>
            <input type="text" id="otp" name="otp" placeholder="Enter 6-Digit Code" required maxlength="6">

            <label for="newPassword">New Password</label>
            <input type="password" id="newPassword" name="newPassword" placeholder="Enter New Password" required minlength="8">

            <label for="confirmPassword">Confirm New Password</label>
            <input type="password" id="confirmPassword" name="confirmPassword" placeholder="Confirm New Password" required minlength="8">

            <button type="submit" class="btn" asp-action="ResetPassword">Reset Password</button>
        }
    </form>

    <div class="extra">
        <a href="@Url.Action("Login", "Account")" class="Login" style="color:grey;font-style:italic;">Return to Login</a>
    </div>
</div>

<style>
    
 
    label {
        display: block;
        margin-top: 15px;
        margin-bottom: 5px;
        font-weight: bold;
        text-align: left;
    }

    /* Style for read-only email box */
    input[readonly] {
        background-color: #eee;
        cursor: not-allowed;
    }

    .text-danger {
        color: #dc3545;
        text-align: left;
        display: block;
        margin-top: 5px;
        font-size: 14px;
    }
</style>